```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>皮卡丘的驚奇分數冒險</title>
    <style>
        body {
            font-family: 'Pokemon Solid', 'Arial Rounded MT Bold', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f8ff; /* 淡藍色背景，類似天空 */
            color: #333;
            line-height: 1.6;
            overflow-x: hidden; /* 防止橫向滾動 */
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
        }

        h1, h2, h3 {
            color: #ffcc00; /* 皮卡丘黃 */
            text-shadow: 2px 2px 0 #ff6600; /* 橘色陰影 */
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        h2 {
            font-size: 2em;
            border-bottom: 3px dashed #ff6600;
            padding-bottom: 10px;
            margin-top: 40px;
        }

        h3 {
            font-size: 1.7em;
            color: #00aaff; /* 皮卡丘藍 */
            margin-top: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .section:nth-child(even) {
            background-color: #f8f8f8; /* 讓區塊有層次感 */
        }

        .intro-text, .explanation {
            font-size: 1.1em;
            margin-bottom: 20px;
            color: #555;
        }

        .interactive-area {
            margin-top: 25px;
            padding: 20px;
            background-color: #ffeebb; /* 較淺的黃色 */
            border: 3px dashed #ff6600;
            border-radius: 10px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .draggable-item, .target-area, .exercise-item, .answer-box, .challenge-timer, .badge-collection, .leaderboard, .download-button {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .draggable-item img, .exercise-item img {
            width: 80px;
            height: 80px;
            cursor: grab;
            transition: transform 0.2s ease-in-out;
        }

        .draggable-item img:active {
            cursor: grabbing;
            transform: scale(1.1);
        }

        .target-area {
            border: 2px dashed #00aaff;
            min-width: 150px;
            min-height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #ff6600;
        }

        .exercise-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            border: 2px solid #ffcc00;
        }

        .exercise-options img {
            width: 60px;
            height: 60px;
            margin: 5px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: border-color 0.3s ease;
        }

        .exercise-options img:hover {
            border-color: #00aaff;
        }

        .answer-box {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            font-size: 1.2em;
        }

        .answer-box input[type="text"] {
            width: 80px;
            padding: 10px;
            border: 2px solid #ffcc00;
            border-radius: 5px;
            text-align: center;
            font-size: 1.1em;
        }

        .submit-button, .challenge-button, .retry-button, .download-button {
            background-color: #ff6600; /* 寶可夢紅色 */
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(255, 102, 0, 0.3);
            margin: 5px;
        }

        .submit-button:hover, .challenge-button:hover, .retry-button:hover, .download-button:hover {
            background-color: #ffcc00; /* 變換成黃色 */
            transform: translateY(-2px);
        }

        .feedback {
            margin-top: 15px;
            font-size: 1.1em;
            font-weight: bold;
        }

        .feedback.correct {
            color: #00cc00; /* 綠色 */
        }

        .feedback.incorrect {
            color: #ff0000; /* 紅色 */
        }

        .animation-example {
            border: 2px dashed #00aaff;
            padding: 15px;
            margin-top: 20px;
            background-color: #e0f7fa; /* 淺青色 */
            border-radius: 10px;
        }

        .animation-example img {
            width: 50px;
            height: 50px;
            margin: 0 5px;
            animation: float 2s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .challenge-timer {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 1.3em;
            color: #ff6600;
            font-weight: bold;
        }

        .badge-collection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .badge {
            width: 70px;
            height: 70px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .badge.badge-1, .badge.badge-2, .badge.badge-3 {
            background-image: url('https://archives.bulbagarden.net/media/upload/thumb/e/ee/Bagde_Cerulean.png/120px-Bagde_Cerulean.png'); /* 示例徽章，可替換 */
        }
        .badge.badge-4, .badge.badge-5, .badge.badge-6 {
             background-image: url('https://archives.bulbagarden.net/media/upload/thumb/c/c8/Bagde_Red.png/120px-Bagde_Red.png'); /* 示例徽章，可替換 */
        }

        .leaderboard {
            background-color: #fff3e0; /* 淺橘色 */
            padding: 20px;
        }

        .leaderboard ol {
            list-style: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .leaderboard li {
            background-color: #ffffff;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
        }

        .leaderboard li span:first-child {
            font-weight: bold;
            color: #ff6600;
        }

        .download-section {
            margin-top: 30px;
            text-align: center;
        }

        .download-button {
            background-color: #00aaff;
            box-shadow: 0 4px 8px rgba(0, 170, 255, 0.3);
        }
        .download-button:hover {
            background-color: #ffcc00;
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            font-size: 0.9em;
            color: #777;
            background-color: #e0f7fa; /* 淺青色 */
        }

        /* 寶可夢風格字體 */
        @font-face {
            font-family: 'Pokemon Solid';
            src: url('pokemon-solid.woff2') format('woff2'), /* 假設您有這個字體文件 */
                 url('pokemon-solid.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        /* 引入外部字體（例如 Google Fonts） */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Press+Start+2P&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif; /* 預設字體 */
        }
        h1, h2, h3 {
            font-family: 'Press Start 2P', cursive; /* 遊戲風格字體 */
        }

        /* 閃電動畫 */
        .lightning-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .lightning-effect::before, .lightning-effect::after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 0, 0.6); /* 黃色閃電 */
            filter: blur(10px);
            opacity: 0;
            animation: flash 1.5s ease-in-out infinite;
        }

        .lightning-effect::before {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            top: 20%;
            left: 30%;
        }

        .lightning-effect::after {
            width: 150px;
            height: 150px;
            top: 60%;
            right: 20%;
            border-radius: 10px;
        }

        @keyframes flash {
            0%, 100% { opacity: 0; transform: scale(0.8); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        /* 寶可夢球動畫 */
        .pokeball-animation {
            display: inline-block;
            width: 50px;
            height: 50px;
            background-image: url('https://archives.bulbagarden.net/media/upload/1/13/Pok%C3%A9_Ball_Sprite.png'); /* 寶可夢球圖案 */
            background-size: contain;
            background-repeat: no-repeat;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>

    <div class="container">
        <div class="lightning-effect"></div>

        <header>
            <img src="https://archives.bulbagarden.net/media/upload/thumb/0/08/025Pikachu_OS_anime_3.png/250px-025Pikachu_OS_anime_3.png" alt="Pikachu" style="width: 150px; margin-bottom: 20px;">
            <h1>皮卡丘的驚奇分數冒險</h1>
            <p class="intro-text">跟著皮卡丘一起，展開一場充滿樂趣的分數學習之旅吧！</p>
        </header>

        <section id="section-intro" class="section">
            <h2>1. 分數是什麼？皮卡丘帶你認識！</h2>
            <p class="explanation">
                皮卡丘最喜歡吃樹果和神奇糖果了！想像一下，如果皮卡丘要把一顆樹果分給他的好朋友，他會怎麼做呢？
                分數就是把一個東西「平分成」幾份，然後我們取出其中的幾份，這時候我們就會用到分數來表示。
            </p>
            <div class="interactive-area">
                <div class="draggable-item">
                    <img id="berry1" src="https://archives.bulbagarden.net/media/upload/thumb/a/a7/Oran_Berry.png/60px-Oran_Berry.png" alt="樹果">
                    <p>1 顆樹果</p>
                </div>
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <p>拖曳樹果到下方區域，並將它想像成被平分成 2 份！</p>
                    <div class="target-area" id="target-area-berry">
                        <span id="berry-parts"></span>
                    </div>
                    <p>我們成功將 1 顆樹果平分成 2 份，每份就是 1/2 (二分之一)！</p>
                </div>
                <div class="draggable-item">
                    <img id="candies1" src="https://archives.bulbagarden.net/media/upload/thumb/1/1e/Rare_Candy.png/60px-Rare_Candy.png" alt="神奇糖果">
                    <p>1 包神奇糖果</p>
                </div>
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <p>試試看，把 1 包神奇糖果平分成 4 份！</p>
                    <div class="target-area" id="target-area-candies">
                        <span id="candies-parts"></span>
                    </div>
                    <p>這時候，每份就是 1/4 (四分之一)！</p>
                </div>
            </div>
        </section>

        <section id="section-addition" class="section">
            <h2>2. 皮卡丘的神奇加法！</h2>
            <p class="explanation">
                皮卡丘的能量球充滿了電力！當皮卡丘吃了不同份數的能量球，他總共吃了多少呢？我們來學習同分母分數的加法！
            </p>
            <div class="interactive-area">
                <div class="exercise-item">
                    <p>題目：皮卡丘吃了 1/5 個能量球，又吃了 2/5 個能量球，總共吃了多少？</p>
                    <div class="exercise-options">
                        <img id="energy-ball-1-5" src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="1/5 能量球">
                        <img id="energy-ball-2-5" src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="2/5 能量球">
                        <img id="energy-ball-3-5" src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="3/5 能量球">
                        <img id="energy-ball-4-5" src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="4/5 能量球">
                    </div>
                    <div class="answer-box">
                        答案： <input type="text" id="answer-add"> / 5
                    </div>
                    <button class="submit-button" onclick="checkAddition()">檢查答案</button>
                    <div id="feedback-add" class="feedback"></div>
                </div>
                <div class="animation-example">
                    <p>讓皮卡丘用動畫告訴你答案！</p>
                    <img src="https://archives.bulbagarden.net/media/upload/thumb/0/08/025Pikachu_OS_anime_3.png/50px-025Pikachu_OS_anime_3.png" alt="Pikachu">
                    <span class="pokeball-animation"></span>
                    <img src="https://archives.bulbagarden.net/media/upload/thumb/0/08/025Pikachu_OS_anime_3.png/50px-025Pikachu_OS_anime_3.png" alt="Pikachu">
                    <span class="pokeball-animation"></span>
                    <img src="https://archives.bulbagarden.net/media/upload/thumb/0/08/025Pikachu_OS_anime_3.png/50px-025Pikachu_OS_anime_3.png" alt="Pikachu">
                </div>
            </div>

            <div class="interactive-area">
                <h3>挑戰模式！</h3>
                <p>隨機題目，挑戰你的速度！</p>
                <div id="challenge-question"></div>
                <div class="answer-box">
                    答案： <input type="text" id="answer-challenge"> / <span id="challenge-denominator"></span>
                </div>
                <button class="challenge-button" onclick="startChallenge()">開始挑戰</button>
                <div id="challenge-timer" style="display: none;">時間：<span id="time-left">60</span>秒</div>
                <div id="feedback-challenge" class="feedback"></div>
                <button class="retry-button" onclick="startChallenge()" style="display: none;">再玩一次</button>
            </div>
        </section>

        <section id="section-subtraction" class="section">
            <h2>3. 皮卡丘的減法魔法！</h2>
            <p class="explanation">
                皮卡丘有好多寶貝球！但有時候不小心會弄掉一些，還剩下多少呢？我們來學習同分母分數的減法！
            </p>
            <div class="interactive-area">
                <div class="exercise-item">
                    <p>題目：皮卡丘有 7/8 個寶貝球，不小心掉了 3/8 個，還剩下多少？</p>
                    <div class="exercise-options">
                        <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                        <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                        <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                        <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                        <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                        <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                        <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                        <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                    </div>
                    <div class="answer-box">
                        答案： <input type="text" id="answer-sub"> / 8
                    </div>
                    <button class="submit-button" onclick="checkSubtraction()">檢查答案</button>
                    <div id="feedback-sub" class="feedback"></div>
                </div>
                <div class="animation-example">
                    <p>看皮卡丘表演減法魔法！</p>
                    <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                    <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                    <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                    <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                    <img src="https://archives.bulbagarden.net/media/upload/thumb/0/08/025Pikachu_OS_anime_3.png/50px-025Pikachu_OS_anime_3.png" alt="Pikachu" style="animation: none;">
                    <span style="font-size: 2em; color: #ff6600; margin: 0 10px;">-</span>
                    <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                    <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                    <img src="https://archives.bulbagarden.net/media/upload/thumb/1/13/Pok%C3%A9_Ball_Sprite.png/80px-Pok%C3%A9_Ball_Sprite.png" alt="寶貝球">
                </div>
            </div>

            <div class="interactive-area">
                <h3>情境題挑戰！</h3>
                <p>皮卡丘在冒險中，會遇到哪些分數問題呢？</p>
                <div id="scenario-question"></div>
                <div class="answer-box">
                    答案： <input type="text" id="answer-scenario"> / <span id="scenario-denominator"></span>
                </div>
                <button class="submit-button" onclick="checkScenario()">檢查答案</button>
                <div id="feedback-scenario" class="feedback"></div>
            </div>
        </section>

        <section id="section-challenge" class="section">
            <h2>4. 皮卡丘的滿分挑戰！</h2>
            <p class="explanation">
                準備好了嗎？這是分數加減法的總複習關卡！通過所有關卡，收集帥氣的徽章吧！
            </p>
            <div class="interactive-area">
                <div id="level-1" class="game-level">
                    <h3>關卡 1：能量補充</h3>
                    <p>題目：皮卡丘吃了 3/7 個能量球，又吃了 1/7 個，總共吃了多少？</p>
                    <div class="answer-box">
                        答案： <input type="text"> / 7
                    </div>
                    <button class="submit-button">下一關</button>
                </div>
                <div id="level-2" class="game-level" style="display: none;">
                    <h3>關卡 2：寶貝球清點</h3>
                    <p>題目：皮卡丘有 5/9 個寶貝球，用了 2/9 個，還剩下多少？</p>
                    <div class="answer-box">
                        答案： <input type="text"> / 9
                    </div>
                    <button class="submit-button">下一關</button>
                </div>
                <div id="level-3" class="game-level" style="display: none;">
                    <h3>關卡 3：混合訓練</h3>
                    <p>題目：皮卡丘吃了 2/6 個神奇糖果，又吃了 3/6 個，他總共吃了多少？</p>
                    <div class="answer-box">
                        答案： <input type="text"> / 6
                    </div>
                    <button class="submit-button">進入結算</button>
                </div>

                <div id="game-result" style="display: none;">
                    <h3>挑戰成功！</h3>
                    <p>你收集到了這些徽章：</p>
                    <div class="badge-collection">
                        <div class="badge badge-1"></div>
                        <div class="badge badge-2"></div>
                        <div class="badge badge-3"></div>
                        <div class="badge badge-4"></div>
                        <div class="badge badge-5"></div>
                        <div class="badge badge-6"></div>
                    </div>
                    <p>你的得分： <span id="final-score"></span></p>
                    <p>你的速度： <span id="final-time"></span></p>
                    <button class="retry-button" onclick="restartGame()">重新挑戰</button>
                </div>
            </div>

            <div class="leaderboard">
                <h3>排行榜</h3>
                <ol>
                    <li><span>1. 小智</span> - 1000 分</li>
                    <li><span>2. 小霞</span> - 950 分</li>
                    <li><span>3. 小剛</span> - 900 分</li>
                    <li><span>4. Kevin</span> - 880 分</li>
                    <li><span>5. 奈斯</span> - 850 分</li>
                </ol>
            </div>
        </section>

        <section id="section-notes" class="section">
            <h2>5. 皮卡丘的學習筆記</h2>
            <p class="explanation">
                來看看皮卡丘記錄下來的重點吧！
            </p>
            <div class="interactive-area" style="background-color: #f0fff0; border-color: #32cd32;">
                <img src="https://archives.bulbagarden.net/media/upload/thumb/0/08/025Pikachu_OS_anime_3.png/100px-025Pikachu_OS_anime_3.png" alt="Pikachu Note" style="width: 100px;">
                <div style="text-align: left; color: #006400; font-size: 1.1em;">
                    <h3>同分母分數加減法規則</h3>
                    <p><strong>加法：</strong> 分子相加，分母不變！</p>
                    <p style="color: #ff0000;">例如： <span style="font-weight: bold;">1/5 + 2/5 = (1+2)/5 = 3/5</span></p>
                    <p><strong>減法：</strong> 分子相減，分母不變！</p>
                    <p style="color: #ff0000;">例如： <span style="font-weight: bold;">7/8 - 3/8 = (7-3)/8 = 4/8</span></p>
                    <p><strong>重點：</strong> 只有當分母相同時，我們才能這樣直接計算分子喔！</p>
                </div>
            </div>

            <div class="download-section">
                <p>想隨身攜帶這份筆記嗎？下載 PDF 版本吧！</p>
                <a href="pikachu_math_notes.pdf" download="Pikachu_Math_Notes.pdf" class="download-button">下載學習筆記 (PDF)</a>
                <br>
                <small>（此為範例連結，實際需提供 PDF 檔案）</small>
            </div>
        </section>

        <footer>
            <p>學習愉快！ Pikachu! Pika Pika!</p>
            <p>&copy; 2026 Kevin 老師 | 圖像與角色版權歸屬寶可夢官方</p>
            <p>參考資源：<a href="https://bulbapedia.bulbagarden.net/" target="_blank">Bulbapedia</a> | <a href="https://www.mathsisfun.com/definitions/fraction.html" target="_blank">Math Is Fun (Fractions)</a></p>
        </footer>
    </div>

    <script>
        // --- JavaScript 互動邏輯 ---

        // 1. 分數是什麼？
        const berry1 = document.getElementById('berry1');
        const targetAreaBerry = document.getElementById('target-area-berry');
        const berryParts = document.getElementById('berry-parts');

        const candies1 = document.getElementById('candies1');
        const targetAreaCandies = document.getElementById('target-area-candies');
        const candiesParts = document.getElementById('candies-parts');

        berry1.ondragstart = (event) => {
            event.dataTransfer.setData("text", "berry");
        };
        candies1.ondragstart = (event) => {
            event.dataTransfer.setData("text", "candies");
        };

        targetAreaBerry.ondragover = (event) => {
            event.preventDefault();
        };
        targetAreaCandies.ondragover = (event) => {
            event.preventDefault();
        };

        targetAreaBerry.ondrop = (event) => {
            event.preventDefault();
            const data = event.dataTransfer.getData("text");
            if (data === "berry") {
                targetAreaBerry.style.backgroundColor = '#e0f7fa'; // 點亮
                berryParts.textContent = "1/2";
                // 這裡可以加入更複雜的視覺效果，例如將圖片分成兩半
            }
        };
        targetAreaCandies.ondrop = (event) => {
            event.preventDefault();
            const data = event.dataTransfer.getData("text");
            if (data === "candies") {
                targetAreaCandies.style.backgroundColor = '#ffe0b2'; // 點亮
                candiesParts.textContent = "1/4";
            }
        };

        // 2. 皮卡丘的神奇加法！
        function checkAddition() {
            const correctAnswer = 3;
            const userAnswer = parseInt(document.getElementById('answer-add').value);
            const feedbackDiv = document.getElementById('feedback-add');

            if (userAnswer === correctAnswer) {
                feedbackDiv.textContent = "太棒了！皮卡丘吃了 3/5 個能量球！";
                feedbackDiv.className = 'feedback correct';
            } else {
                feedbackDiv.textContent = "嗯...再想想看，分母相同時，我們只要把分子加起來就好囉！";
                feedbackDiv.className = 'feedback incorrect';
            }
        }

        let challengeTimerInterval;
        let timeLeft = 60;
        let score = 0;
        let correctAnswers = 0;

        function startChallenge() {
            clearInterval(challengeTimerInterval);
            timeLeft = 60;
            score = 0;
            correctAnswers = 0;
            document.getElementById('time-left').textContent = timeLeft;
            document.getElementById('challenge-timer').style.display = 'block';
            document.getElementById('feedback-challenge').textContent = '';
            document.getElementById('answer-challenge').value = '';
            document.getElementById('retry-button').style.display = 'none';

            generateChallengeQuestion();

            challengeTimerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('time-left').textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(challengeTimerInterval);
                    endChallenge();
                }
            }, 1000);
        }

        function generateChallengeQuestion() {
            const denominator = Math.floor(Math.random() * 7) + 3; // 分母 3-9
            const num1 = Math.floor(Math.random() * (denominator - 1)) + 1;
            const num2 = Math.floor(Math.random() * (denominator - num1)) + 1; // 確保不超過分母
            const correctAnswer = num1 + num2;

            document.getElementById('challenge-question').innerHTML = `題目：皮卡丘吃了 ${num1}/${denominator} 個點心，又吃了 ${num2}/${denominator} 個，總共吃了多少？`;
            document.getElementById('challenge-denominator').textContent = denominator;
            document.getElementById('answer-challenge').dataset.correct = correctAnswer; // 儲存正確答案
        }

        document.getElementById('answer-challenge').addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                checkChallengeAnswer();
            }
        });

        function checkChallengeAnswer() {
            const userAnswer = parseInt(document.getElementById('answer-challenge').value);
            const correctAnswer = parseInt(document.getElementById('answer-challenge').dataset.correct);
            const feedbackDiv = document.getElementById('feedback-challenge');

            if (userAnswer === correctAnswer) {
                feedbackDiv.textContent = "答對了！真厲害！";
                feedbackDiv.className = 'feedback correct';
                score += 10;
                correctAnswers++;
                // 暫停計時，顯示下一題
                clearInterval(challengeTimerInterval);
                setTimeout(() => {
                    document.getElementById('answer-challenge').value = '';
                    feedbackDiv.textContent = '';
                    generateChallengeQuestion();
                    // 重新開始計時
                    challengeTimerInterval = setInterval(() => {
                        timeLeft--;
                        document.getElementById('time-left').textContent = timeLeft;
                        if (timeLeft <= 0) {
                            clearInterval(challengeTimerInterval);
                            endChallenge();
                        }
                    }, 1000);
                }, 1500);
            } else {
                feedbackDiv.textContent = "嗯... 再檢查一下數字吧！";
                feedbackDiv.className = 'feedback incorrect';
            }
        }

        function endChallenge() {
            document.getElementById('challenge-timer').style.display = 'none';
            document.getElementById('challenge-question').textContent = '挑戰時間到！';
            document.getElementById('feedback-challenge').textContent = `總共答對 ${correctAnswers} 題！`;
            document.getElementById('retry-button').style.display = 'block';
            // 這裡可以根據 score 更新排行榜，但為了簡化，先不實現
        }

        // 3. 皮卡丘的減法魔法！
        function checkSubtraction() {
            const correctAnswer = 4;
            const userAnswer = parseInt(document.getElementById('answer-sub').value);
            const feedbackDiv = document.getElementById('feedback-sub');

            if (userAnswer === correctAnswer) {
                feedbackDiv.textContent = "沒錯！還剩下 4/8 個寶貝球！";
                feedbackDiv.className = 'feedback correct';
            } else {
                feedbackDiv.textContent = "再仔細看看，剩下多少呢？";
                feedbackDiv.className = 'feedback incorrect';
            }
        }

        // 情境題
        const scenarioQuestions = [
            { question: "皮卡丘的寶可夢隊伍裡有 6/7 的隊員是電氣屬性，其中 2/7 的隊員是皮卡丘，請問隊伍中有多少比例不是皮卡丘的電氣屬性寶可夢？", denominator: 7, answer: 4 },
            { question: "皮卡丘原本有 8/10 的能量，被火箭隊搶走 3/10，現在還剩下多少能量？", denominator: 10, answer: 5 }
        ];
        let currentScenarioIndex = 0;

        function loadScenarioQuestion() {
            const qData = scenarioQuestions[currentScenarioIndex];
            document.getElementById('scenario-question').textContent = `題目：${qData.question}`;
            document.getElementById('scenario-denominator').textContent = qData.denominator;
            document.getElementById('answer-scenario').value = '';
            document.getElementById('feedback-scenario').textContent = '';
            document.getElementById('answer-scenario').dataset.correct = qData.answer;
        }

        function checkScenario() {
            const userAnswer = parseInt(document.getElementById('answer-scenario').value);
            const correctAnswer = parseInt(document.getElementById('answer-scenario').dataset.correct);
            const feedbackDiv = document.getElementById('feedback-scenario');

            if (userAnswer === correctAnswer) {
                feedbackDiv.textContent = "太棒了！完美解決！";
                feedbackDiv.className = 'feedback correct';
                // 載入下一題，或者提示完成
                setTimeout(() => {
                    currentScenarioIndex++;
                    if (currentScenarioIndex < scenarioQuestions.length) {
                        loadScenarioQuestion();
                    } else {
                        feedbackDiv.textContent = "所有情境題都完成囉！";
                        feedbackDiv.className = 'feedback correct';
                        document.getElementById('answer-scenario').disabled = true;
                    }
                }, 1500);
            } else {
                feedbackDiv.textContent = "嗯... 讓我們再檢查一下計算過程。";
                feedbackDiv.className = 'feedback incorrect';
            }
        }
        loadScenarioQuestion(); // 載入第一題

        // 4. 皮卡丘的滿分挑戰！
        const gameLevels = document.querySelectorAll('.game-level');
        const gameResultSection = document.getElementById('game-result');
        let currentLevel = 0;

        function nextLevel() {
            const currentLevelElement = document.getElementById(`level-${currentLevel + 1}`);
            const input = currentLevelElement.querySelector('input[type="text"]');
            const feedbackDiv = currentLevelElement.querySelector('.submit-button'); // 暫用按鈕區域顯示回饋

            // 簡單檢查答案 (需完善)
            // 這裡只是模擬，實際應有更嚴謹的檢查
            if (input.value.trim() === "") {
                alert("請先輸入答案！");
                return;
            }

            // 移除當前關卡
            currentLevelElement.style.display = 'none';
            currentLevel++;

            if (currentLevel < gameLevels.length) {
                const nextLevelElement = document.getElementById(`level-${currentLevel + 1}`);
                nextLevelElement.style.display = 'block';
            } else {
                // 所有關卡完成
                document.getElementById('level-3').style.display = 'none'; // 隱藏最後一關的輸入框
                gameResultSection.style.display = 'block';
                // 模擬得分和時間
                document.getElementById('final-score').textContent = Math.floor(Math.random() * 1000) + 500;
                document.getElementById('final-time').textContent = Math.floor(Math.random() * 60) + 30 + " 秒";
            }
        }

        // 替換按鈕的點擊事件
        document.querySelectorAll('.game-level .submit-button').forEach(button => {
            button.onclick = nextLevel;
        });

        function restartGame() {
            currentLevel = 0;
            gameResultSection.style.display = 'none';
            document.getElementById('level-1').style.display = 'block';
            document.querySelectorAll('.game-level input[type="text"]').forEach(input => input.value = '');
        }

        // 5. 皮卡丘的學習筆記
        // PDF 下載功能由瀏覽器處理，這裡無須額外 JS


        // 初始化挑戰模式
        startChallenge();

    </script>
</body>
</html>
```